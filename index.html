<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>–ú–æ–∏—Ç–µ –Ω–æ–≤–∏–Ω–∏</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f1418">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside id="sidebar" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="brand">üì∞ –ú–æ–∏—Ç–µ –Ω–æ–≤–∏–Ω–∏</div>
      <div class="cats-loading">–ó–∞—Ä–µ–∂–¥–∞–º –º–µ–Ω—é...</div>
    </aside>

    <main id="main">
      <div class="top">
        <div class="left-actions">
          <button id="menuToggle" class="icon-btn" aria-label="–û—Ç–≤–æ—Ä–∏ –º–µ–Ω—é">‚ò∞</button>
          <button id="collapseToggle" class="icon-btn desktop-only" aria-label="–°–≤–∏–π/—Ä–∞–∑–≥—ä—Ä–Ω–∏ –º–µ–Ω—é" title="–°–≤–∏–π/—Ä–∞–∑–≥—ä—Ä–Ω–∏ –º–µ–Ω—é">‚ü®‚ü©</button>
        </div>
        <h2 class="headline">–ü–æ—Å–ª–µ–¥–Ω–∏ –Ω–æ–≤–∏–Ω–∏</h2>
      </div>

      <div id="status" class="status"></div>

      <section class="filters">
        <div class="time-filters scroller">
          <button class="chip" data-filter="today">–î–Ω–µ—Å</button>
          <button class="chip" data-filter="week">–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞</button>
          <button class="chip" data-filter="month">–¢–æ–∑–∏ –º–µ—Å–µ—Ü</button>
          <button class="chip active" data-filter="all">–í—Å–∏—á–∫–∏</button>
        </div>
        <div class="category-filter">
          <label for="categorySelect" class="cat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
          <select id="categorySelect">
            <option value="all">–í—Å–∏—á–∫–∏</option>
          </select>
        </div>
      </section>

      <div id="list" class="list">
        <div class="placeholder">–ò–∑–ø–æ–ª–∑–≤–∞–π <b>–º–µ–Ω—é—Ç–æ</b> –æ—Ç–ª—è–≤–æ, –∑–∞ –¥–∞ –∑–∞—Ä–µ–¥–∏—à –Ω–æ–≤–∏–Ω–∏.</div>
      </div>
    </main>
  </div>

  <!-- Reader -->
  <div id="reader" class="reader" style="display:none" aria-hidden="true">
    <div class="reader-backdrop"></div>
    <div class="reader-panel">
      <div class="reader-bar">
        <div class="reader-title">–ß–µ—Ç–µ—Ü</div>
        <button id="readerClose" class="btn">–ó–∞—Ç–≤–æ—Ä–∏</button>
      </div>
      <div id="readerContent" class="reader-content"></div>
    </div>
  </div>

<script>
const DEFAULT_ICON = 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/1f4f0.svg'; // üì∞

const $ = s => document.querySelector(s);
const listEl = $('#list'), sidebarEl = $('#sidebar'), mainEl = $('#main');
function setStatus(msg){ $('#status').textContent = msg||''; }
function parseHTML(h){return new DOMParser().parseFromString(h,'text/html');}
function absURL(b,r){try{return new URL(r,b).href}catch{return r}}
function sanitize(n){n.querySelectorAll('script,style,iframe').forEach(x=>x.remove());return n;}

async function loadSidebar(){
  try{
    const html = await fetch('sidebar.html').then(r=>r.text());
    sidebarEl.innerHTML = html;

    sidebarEl.querySelectorAll('[data-url]').forEach(el=>{
      el.classList.add('cat');
      const labelText = el.textContent.trim();
      el.innerHTML='';
      const icon = el.getAttribute('data-icon')||DEFAULT_ICON;
      const img=document.createElement('img');img.src=icon;img.className='fav';img.alt='';
      const span=document.createElement('span');span.className='label';span.textContent=labelText;
      el.append(img,span);
      el.title=labelText;
    });

    sidebarEl.addEventListener('click',e=>{
      const btn=e.target.closest('[data-url]');
      if(!btn)return;
      importURL(btn.dataset.url);
    });
  }catch{sidebarEl.innerHTML='<div class="placeholder">‚ùå –ù–µ —É—Å–ø—è—Ö –¥–∞ –∑–∞—Ä–µ–¥—è –º–µ–Ω—é.</div>';}
}
loadSidebar();

/* === importURL & render (–∫—Ä–∞—Ç–∫–æ, —Å–∞–º–æ –∏–¥–µ—è—Ç–∞) === */
async function importURL(url){
  setStatus('‚è≥ –ó–∞—Ä–µ–∂–¥–∞–º –Ω–æ–≤–∏–Ω–∏‚Ä¶');
  const prox=`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
  const res=await fetch(prox);const html=await res.text();
  const doc=parseHTML(html);
  const blocks=doc.querySelectorAll('div.card.pt-4.pb-4.ad0,div.card.pt-4.pb-4.ad3');
  listEl.innerHTML='';
  blocks.forEach(b=>listEl.appendChild(toCard(b.outerHTML,url)));
  setStatus('');
}
function toCard(html,base){
  const d=parseHTML('<div>'+html+'</div>');
  const img=d.querySelector('img');const src=img?absURL(base,img.src):'';
  const h=d.querySelector('h1,h2,h3');const title=h?h.textContent.trim():'(–±–µ–∑ –∑–∞–≥–ª–∞–≤–∏–µ)';
  const link=h?.querySelector('a[href]')?.href||d.querySelector('a[href]')?.href||'';
  const a=document.createElement('div');a.className='card-row';a.innerHTML=
  `<div class="thumb">${src?`<img src="${src}">`:'<span>no</span>'}</div>
   <div class="right-side"><div class="header-row"><h3 class="title"><a href="#">${title}</a></h3></div></div>`;
  a.querySelector('a').onclick=e=>{e.preventDefault();openReader(link)};
  return a;
}

/* === Reader simplified === */
const reader=$('#reader'), readerContent=$('#readerContent');
$('#readerClose').onclick=()=>{reader.style.display='none';};
async function openReader(url){
  const prox=`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
  const res=await fetch(prox);const html=await res.text();const doc=parseHTML(html);
  const article=doc.querySelector('article')||doc.querySelector('.article')||doc.body;
  sanitize(article);
  const text=article.innerText.trim().split(/\n{2,}/).map(p=>`<p>${p}</p>`).join('');
  readerContent.innerHTML=text;reader.style.display='block';
}

/* === Hide title on scroll === */
let last=0;mainEl.addEventListener('scroll',()=>{
  const st=mainEl.scrollTop;
  if(st>last&&st>30)document.body.classList.add('scrolling-down');
  else document.body.classList.remove('scrolling-down');
  last=st<=0?0:st;
});
</script>
</body>
</html>